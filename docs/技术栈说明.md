# PrecomControl 技术栈说明

## 📋 技术栈概览

PrecomControl 是一个基于 Python Flask 的 Web 应用系统，采用前后端分离的架构设计。

---

## 🔧 后端技术栈

### 核心框架

| 技术 | 版本 | 用途 |
|------|------|------|
| **Python** | 3.7+ | 编程语言 |
| **Flask** | 2.3.3 | Web 框架，提供路由、模板、会话等功能 |
| **WSGI** | - | Web 服务器网关接口标准 |

### Web 框架扩展

| 技术 | 版本 | 用途 |
|------|------|------|
| **Flask-WTF** | ≥1.0.0 | CSRF 保护、表单验证 |
| **Flask-Babel** | ≥4.0.0 | 国际化支持（i18n），支持中文、英文、俄文 |
| **Werkzeug** | ≥2.3.7 | Flask 底层工具库，提供密码哈希、安全功能 |

### 数据库

| 技术 | 版本 | 用途 |
|------|------|------|
| **MySQL** | 5.7+ | 关系型数据库 |
| **mysql-connector-python** | 8.1.0 | MySQL 官方 Python 驱动，支持连接池 |

### WSGI 服务器（生产环境）

| 技术 | 平台 | 用途 |
|------|------|------|
| **Waitress** | ≥2.1.0 | Windows 生产环境 WSGI 服务器（纯 Python） |
| **Gunicorn** | - | Linux 生产环境 WSGI 服务器（支持多进程） |

### 数据处理库

| 技术 | 版本 | 用途 |
|------|------|------|
| **pandas** | ≥2.0.0 | 数据分析和处理，Excel 数据导入导出 |
| **openpyxl** | ≥3.1.0 | Excel 文件读写（.xlsx 格式） |
| **Pillow** | ≥10.0.0 | 图像处理，支持图片上传和处理 |

### 安全与加密

| 技术 | 版本 | 用途 |
|------|------|------|
| **cryptography** | ≥41.0.0 | 加密库，用于 SSL 证书生成和管理 |
| **Werkzeug.security** | - | 密码哈希（PBKDF2），用户密码加密存储 |

### 系统集成

| 技术 | 版本 | 用途 |
|------|------|------|
| **pywin32** | ≥305 | Windows 系统 API 调用，Windows 特定功能 |

---

## 🎨 前端技术栈

### UI 框架

| 技术 | 版本 | 用途 |
|------|------|------|
| **Bootstrap** | 5.1.3 | CSS 框架，响应式布局、组件库 |
| **Bootstrap Icons** | 1.11.0 | 图标库，提供丰富的图标 |

### JavaScript 库

| 技术 | 版本 | 用途 |
|------|------|------|
| **jQuery** | 3.6.0 | JavaScript 库，DOM 操作、AJAX 请求 |
| **Font Awesome** | 6.0.0 | 图标字体库 |

### 模板引擎

| 技术 | 版本 | 用途 |
|------|------|------|
| **Jinja2** | ≥3.1.2 | Flask 默认模板引擎，服务端渲染 HTML |

---

## 🌐 Web 服务器

### 反向代理

| 技术 | 版本 | 用途 |
|------|------|------|
| **Nginx** | 1.24+ | 反向代理、负载均衡、SSL/TLS 终止、静态文件服务 |

### 协议支持

- **HTTP/1.1** - 标准 HTTP 协议
- **HTTP/2** - 支持 HTTP/2（通过 Nginx）
- **HTTPS/TLS** - TLS 1.2/1.3 加密传输

---

## 🔐 安全技术

### 认证与授权

- **用户认证系统** - 基于用户名密码的登录认证
- **RBAC（基于角色的访问控制）** - 权限分级管理
- **会话管理** - Flask Session，8 小时有效期
- **密码安全** - PBKDF2 哈希算法，密码不存储明文

### 安全防护

- **CSRF 保护** - Flask-WTF CSRF Token
- **SQL 注入防护** - 参数化查询
- **XSS 防护** - 模板自动转义
- **安全头部** - HSTS, X-Frame-Options, CSP 等

### 传输安全

- **HTTPS/SSL** - TLS 1.2/1.3 加密
- **证书管理** - 支持自签名证书和 CA 证书

---

## 🌍 国际化（i18n）

| 技术 | 用途 |
|------|------|
| **Babel** | 国际化工具，提取和编译翻译文本 |
| **Flask-Babel** | Flask 国际化扩展 |
| **支持语言** | 中文（zh_CN）、英文（en_US）、俄文（ru_RU） |

---

## 📦 开发工具

### 国际化工具

- **pybabel** - Babel 命令行工具，用于提取、更新、编译翻译文件

### 代码组织

- **Blueprint** - Flask 蓝图，模块化路由组织
- **工厂模式** - `create_app()` 工厂函数创建应用实例

---

## 🗄️ 数据库设计

### 数据库类型

- **MySQL 5.7+** / **MariaDB 10.3+**

### 特性

- **连接池** - MySQLConnectionPool，最大 32 个连接
- **事务支持** - 手动提交事务，确保数据一致性
- **字符集** - UTF-8MB4，支持中文和特殊字符

---

## 🚀 部署技术

### Windows 部署

- **Waitress** - WSGI 服务器
- **NSSM** - Windows 服务管理器（可选）
- **PowerShell** - 部署和启动脚本

### Linux 部署

- **Gunicorn** - WSGI 服务器（多进程）
- **systemd** - 系统服务管理（可选）
- **Bash** - 部署脚本

### 容器化（可选）

- **Docker** - 容器化部署（如需要）
- **Docker Compose** - 多容器编排（如需要）

---

## 📊 架构模式

### 设计模式

- **MVC 模式** - Model-View-Controller 架构
- **工厂模式** - 应用创建
- **装饰器模式** - 路由和权限控制
- **单例模式** - 数据库连接池

### 代码组织

```
PrecomControl/
├── app.py              # 应用工厂
├── wsgi.py            # WSGI 入口
├── config.py          # 配置管理
├── database.py        # 数据库连接
├── models/           # 数据模型
├── routes/            # 路由（控制器）
├── templates/         # 视图（模板）
├── static/            # 静态资源
├── utils/             # 工具函数
└── scripts/           # 部署脚本
```

---

## 🔄 数据流

1. **请求流程**：
   ```
   客户端 → Nginx → Waitress/Gunicorn → Flask → 路由 → 视图 → 模板 → 响应
   ```

2. **数据库访问**：
   ```
   Flask 路由 → 数据库模型 → 连接池 → MySQL
   ```

3. **文件上传**：
   ```
   客户端 → Flask → 文件验证 → 保存到 uploads/ → 数据库记录
   ```

---

## 📈 性能特性

- **连接池** - 数据库连接复用，减少连接开销
- **静态文件缓存** - Nginx 缓存静态资源
- **多进程/多线程** - Gunicorn 多进程，Waitress 多线程
- **异步处理** - 支持并发请求处理

---

## 🛠️ 开发环境

### 必需工具

- **Python 3.7+**
- **MySQL 5.7+**
- **Git** - 版本控制
- **虚拟环境** - `venv` 或 `virtualenv`

### 可选工具

- **Poedit** - 翻译文件编辑器
- **MySQL Workbench** - 数据库管理工具
- **VS Code / PyCharm** - 代码编辑器

---

## 📝 总结

PrecomControl 采用**现代 Python Web 开发技术栈**，具有以下特点：

✅ **成熟稳定** - 使用经过验证的开源技术  
✅ **安全可靠** - 多层安全防护机制  
✅ **易于维护** - 清晰的代码组织和文档  
✅ **可扩展** - 模块化设计，易于扩展功能  
✅ **跨平台** - 支持 Windows 和 Linux 部署  
✅ **国际化** - 支持多语言切换  

---

## 📚 相关文档

- [部署指南](../部署指南.md) - 详细部署说明
- [安全建议](./安全建议.md) - 安全配置建议
- [端口配置](../PORT_CONFIG.md) - 端口使用说明

