{% extends "base_industrial.html" %}

{% block title %}{{ '新增子系统' if mode == 'create' else '编辑子系统' }} - 预试车管理系统{% endblock %}

{% block extra_styles %}
<style>
    .form-card {
        background: white;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        padding: 1.75rem;
        box-shadow: 0 8px 30px rgba(15, 30, 60, 0.12);
    }
    .section-title {
        font-size: 1.15rem;
        font-weight: 700;
        color: var(--primary-blue);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .section-title i {
        font-size: 1.2rem;
        color: var(--industrial-orange);
    }
    .form-label {
        font-weight: 600;
        letter-spacing: 0.5px;
        color: var(--text-primary);
    }
    .form-control, .form-select, textarea {
        border-radius: 6px;
        border: 1.5px solid var(--border-color);
        transition: all 0.2s ease;
    }
    .form-control:focus, .form-select:focus, textarea:focus {
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 0.2rem rgba(20, 60, 120, 0.15);
    }
    .page-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        margin-bottom: 1.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container-fluid">
        <h1>
            <i class="bi bi-diagram-3"></i>
            {{ '新增子系统' if mode == 'create' else '编辑子系统' }}
        </h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="bi bi-house-door"></i> 首页</a></li>
                <li class="breadcrumb-item"><a href="/subsystems">子系统管理</a></li>
                <li class="breadcrumb-item active" aria-current="page">
                    {{ '新增子系统' if mode == 'create' else subsystem.SubSystemCode }}
                </li>
            </ol>
        </nav>
    </div>
</div>

<div class="page-actions">
    <a href="/subsystems" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> 返回列表
    </a>
</div>

{% if error_message %}
<div class="alert alert-danger">
    <i class="bi bi-exclamation-triangle"></i> {{ error_message }}
</div>
{% endif %}

{% if mode == 'edit' and subsystem is none %}
<div class="alert alert-warning">
    指定的子系统不存在或已被删除。
    <a href="/subsystems" class="alert-link">返回子系统列表</a>
</div>
{% else %}
<div class="form-card">
    <form method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="row g-4">
            <div class="col-md-4">
                <label class="form-label">子系统代码 *</label>
                {% if mode == 'create' %}
                <input type="text" class="form-control" name="SubSystemCode"
                       value="{{ subsystem.SubSystemCode }}" required placeholder="例如：CD-101-A01">
                {% else %}
                <input type="text" class="form-control" value="{{ subsystem.SubSystemCode }}" readonly>
                <div class="form-text text-muted">子系统代码不可修改</div>
                {% endif %}
            </div>
            <div class="col-md-4">
                <label class="form-label">所属系统 *</label>
                <select class="form-select" name="SystemCode" required>
                    <option value="">请选择系统</option>
                    {% for system in systems %}
                    <option value="{{ system.SystemCode }}"
                            {% if subsystem.SystemCode == system.SystemCode %}selected{% endif %}>
                        {{ system.SystemCode }} - {{ system.SystemDescriptionENG }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">类型 *</label>
                <select class="form-select" name="ProcessOrNonProcess" required>
                    <option value="">请选择类型</option>
                    <option value="Process" {% if subsystem.ProcessOrNonProcess == 'Process' %}selected{% endif %}>工艺</option>
                    <option value="NonProcess" {% if subsystem.ProcessOrNonProcess == 'NonProcess' %}selected{% endif %}>非工艺</option>
                </select>
            </div>
        </div>

        <hr class="my-4">

        <div class="row g-4">
            <div class="col-md-6">
                <label class="form-label">子系统描述（英文） *</label>
                <input type="text" class="form-control" name="SubSystemDescriptionENG"
                       value="{{ subsystem.SubSystemDescriptionENG }}" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">子系统描述（俄文）</label>
                <input type="text" class="form-control" name="SubSystemDescriptionRUS"
                       value="{{ subsystem.SubSystemDescriptionRUS }}">
            </div>
        </div>

        <div class="row g-4 mt-1">
            <div class="col-md-4">
                <label class="form-label">优先级</label>
                <input type="number" class="form-control" name="Priority"
                       value="{{ subsystem.Priority or 0 }}" min="0" max="10">
            </div>
            <div class="col-md-8">
                <label class="form-label">备注</label>
                <textarea class="form-control" name="Remarks" rows="2"
                          placeholder="可选">{{ subsystem.Remarks }}</textarea>
            </div>
        </div>

        <div class="mt-4 text-end">
            <a href="/subsystems" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i> 取消
            </a>
            <button type="submit" class="btn btn-primary ms-2">
                <i class="bi bi-save"></i> {{ '创建子系统' if mode == 'create' else '保存修改' }}
            </button>
        </div>
    </form>
</div>
{% endif %}
{% endblock %}

